# <a href = "../README.md" target="_blank">원리부터 배우는 관계형 데이터베이스 실전 입문</a>
## Chapter 01. SQL과 관계형 모델
### 1.3 SQL에서 릴레이션 조작
1) SELECT의 기본형
2) 확장(extend)의 평가 순서
3) INSERT(삽입)
4) DELETE(삭제)
5) UPDATE(갱신)

---

# 1.3 SQL에서 릴레이션 조작

---

## 1) SELECT의 기본형
```sql
SELECT 칼럼의 목록
FROM 테이블의 목록
WHERE 검색 조건
```

### 1.1 SELECT에서 릴레이션 연산의 논리적 평가 순서
SELECT는 논리적인 곱집합, 제한, 프로젝션의 세가지 릴레이션 연산을 동시에 수행하는 작업이다.
1. 테이블의 목록(곱집합)
2. 검색 조건(제한)
3. 칼럼의 목록(프로젝션)

### 1.2 실제 RDB에서는 논리적 평가 순서와 실제 실제 실행 순서가 관계 없음
- RDB의 옵티마이저가 최적화를 실시해, 처리를 생략하거나 실행 순서를 바꿈
- RDB가 수행하는 최적화는 구현된 기능이고, 실제 보여주려는 내용은 결과적으론 같다.

---

## 2) 확장(extend)의 평가 순서

### 2.1 확장
원래 테이블에서 기존 칼럼들을 기반으로 유도해, 존재하지 않는 칼럼을 만들어냄

### 2.2 확장의 평가 순서
프로젝션 직전에 수행됨

### 2.3 사용례 - 기존 칼럼들로부터 유도한 연산결과를 지정
```sql
SELECT name, weight, weight * 2.2 as weight_lb
    FROM t;
```

### 2.4 오류가 발생하는 SQL의 예
```sql
SELECT name, weight, weight * 2.2 as weight_1b (3) 
    FROM t (1)
    WHERE weight_lb > 100; (2)
```
- 논리적 순서상으로 먼저오는 연산 시점엔 선언되지 않은 칼럼을 사용하게 되므로 모순임.
- 주의점 : SQL에 따라 오류가 발생하지 않을 수도 있으나, RDB 의 특수한 사양에 의존하지 않고 SQL 표준을 생각하며 SQL을 작성해야함

---

## 3) INSERT(삽입)

### 3.1 관계형 모델에는 갱신, 삽입 개념이 존재하지 않는다.
- 릴레이션은 값이다.
- 아무리 많은 요소가 포함되어 있더라도 릴레이션 전체는 하나의 값이며 그 의미는 갱신되지 않는다.

### 3.2 Relvar : 관계형 모델에서 릴레이션을 저장하는 변수
- Relvar(Relation + Variable : 관계 변수)
- SQL에는 본래 Relvar라는 개념은 존재하지 않는 개념이다.
  - SQL은 테이블에서 읽은 행의 모임(다중 집합)을 변수에 대입하는 방법이 없다.
  - 결과적으로 SQL은 테이블이 릴레이션(값)에 해당하는 것과 동시에 Relvar(변수)의 역할도 겸하도록 했다.


### 3.3 SQL에서 테이블 갱신 : Relva
- Relvar을 통해 테이블을 갱신할 수 있음.

### 3.4 INSERT의 의미
```text
R := R ∪ {T}
```
- Relvar의 값을, 해당 릴레이션에 새로운 값을 INSERT할 튜플을 추가하고 릴레이션과 바꾸는 작업
  - `R` : Relvar
  - `T` : 새로 삽입할 행에 대한 튜플
  - `{T}` : 튜플 T만 포함하는 릴레이션

---

## 4) DELETE(삭제)
```sql
DELETE FROM WHERE c1 = 100;
```
```text
R := R - {T}
```
- Relvar의 값을, 전체 릴레이션에서 조건에 맞는 튜플의 집합(부분집합)의 차집합을 대입하는 것 

---

## 5) UPDATE(갱신)
```sql
UPDATE t SET c1 = 1 WHERE c2 = 123;
```
```text
R := {R- {T1}} U {T2} 
```
- WHERE 절의 조건에 해당하는 릴레이션은 `{T1}`, `{T1}`에 수정을 가한 릴레이션은 `{T2}`
- 전체 릴레이션에서 {T1}의 차집합을 구하고, {T2}와 합집합을 구한다.
- 합집합 결과를 다시 Relvar에 할당한다.
- 즉 UPDATE 연산은 논리적으로 DELETE, INSERT의 조합으로 볼 수 있다.

---
